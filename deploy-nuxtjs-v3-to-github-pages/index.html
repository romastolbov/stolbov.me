<!DOCTYPE html>
<html lang="ru">
<head><meta charset="utf-8">
<title>Деплой Nuxt.js v3 проекта на GitHub Pages — Рома Столбов</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Нельзя просто так взять и задеплоить"><link rel="modulepreload" href="/deploy-nuxtjs-v3-to-github-pages/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.bdb45715.js"><link rel="preload" as="style" href="/_nuxt/entry.97c5bfaf.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.3cb96fe8.js"><link rel="preload" as="style" href="/_nuxt/default.dab6f2e1.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/constants.add2c060.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.3e5028d5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_slug_.ceeb69c5.js"><link rel="preload" as="style" href="/_nuxt/_slug_.009b7534.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentDoc.eac9264d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.ba78f7cd.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.af1a1db5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.fed2a411.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentQuery.9de9e460.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/asyncData.4d5fa1cf.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.d0fd233a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.6d0e47ca.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseImg.0702c91a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.bdbbde47.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.540490cd.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCodeInline.ed385caf.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseBlockquote.e795d595.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.bf9517cc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseOl.de5b6f67.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.298573e3.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH3.16ac78a9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.24d3a39d.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentNavigation.16d1cf07.js"><link rel="prefetch" as="style" href="/_nuxt/ContentNavigation.a244f75e.css"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentList.975c1b30.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/ContentSlot.efb6201f.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DocumentDrivenEmpty.909d97a6.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DocumentDrivenNotFound.6a0af9f7.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Markdown.0825b956.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/web-socket.3586211e.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.4406f679.js"><link rel="stylesheet" href="/_nuxt/entry.97c5bfaf.css"><link rel="stylesheet" href="/_nuxt/default.dab6f2e1.css"><link rel="stylesheet" href="/_nuxt/_slug_.009b7534.css"><style>.footer{padding-bottom:var(--vertical-padding);padding-top:100px}.footer__copyright{border-top:1px solid var(--border);color:var(--secondary);font-size:14px;padding-top:25px}.footer__copyright a{color:var(--color)}</style><style>.post h1{margin:2rem 0 0}.post__header{margin-bottom:3.5rem}.post__date{color:var(--secondary);display:inline-block;font-size:14px;margin:8px 0}.post__content>:nth-last-child(-n+2){margin-bottom:0}</style><style>pre code .line{display:block;min-height:1rem}</style><script>"use strict";const w=window,de=document.documentElement,knownColorSchemes=["dark","light"],preference=window.localStorage.getItem("nuxt-color-mode")||"system";let value=preference==="system"?getColorScheme():preference;const forcedColorMode=de.getAttribute("data-color-mode-forced");forcedColorMode&&(value=forcedColorMode),addColorScheme(value),w["__NUXT_COLOR_MODE__"]={preference,value,getColorScheme,addColorScheme,removeColorScheme};function addColorScheme(e){const o=""+e+"-mode",t="";de.classList?de.classList.add(o):de.className+=" "+o,t&&de.setAttribute("data-"+t,e)}function removeColorScheme(e){const o=""+e+"-mode",t="";de.classList?de.classList.remove(o):de.className=de.className.replace(new RegExp(o,"g"),""),t&&de.removeAttribute("data-"+t)}function prefersColorScheme(e){return w.matchMedia("(prefers-color-scheme"+e+")")}function getColorScheme(){if(w.matchMedia&&prefersColorScheme("").media!=="not all"){for(const e of knownColorSchemes)if(prefersColorScheme(":"+e).matches)return e}return"light"}
</script></head>
<body ><div id="__nuxt"><!--[--><main><!--[--><section><div class="container container--small"><a href="/" class=""> Назад </a><!--[--><article class="post"><header class="post__header"><h1>Деплой Nuxt.js v3 проекта на GitHub Pages</h1><time datetime="5 января, 2023" class="post__date">5 января, 2023</time></header><div class="post__content"><p><!--[-->Если создать свежий проект на Nuxt.js 3, сгенерировать статику, запушить все это
дело на GitHub и попробовать подключить GitHub Pages – работать оно конечно будет, но очень криво.<!--]--></p><p><!--[-->В консоли можно будет наблюдать кучу ошибок 404, исходя из чего можно сделать вывод что мы либо
похерели часть файлов на этапе сборки, либо лежат они не там где нам нужно.<!--]--></p><p><!--[--><img src="/img/nuxt-v3-github-pages-404-error.png" alt="Базовый проект Nuxt.js v3" title="Не хватает файлов сборки"><!--]--></p><h2 id="почему-так-происходит"><a href="#почему-так-происходит"><!--[-->Почему так происходит<!--]--></a></h2><p><!--[-->Данная проблема возникает из-за того что GitHub Pages под капотом использует
генератор статических сайтов <a href="https://jekyllrb.com/" rel="nofollow" target="_blank"><!--[-->Jekyll<!--]--></a>,
который в свою очередь имеет такую особенность как игнорирование (по умолчанию, но можно переопределить)
файлов и папок названия которых начинаются с символов: <code><!--[-->.<!--]--></code>, <code><!--[-->_<!--]--></code>, <code><!--[-->#<!--]--></code> или <code><!--[-->~<!--]--></code>.<!--]--></p><blockquote><!--[--><p><!--[-->Every file or directory beginning with the following characters: ., _ , # or ~ in the
source directory will not be included in the destination folder.
Such paths will have to be explicitly specified via the config file in the
include directive to make sure they’re copied over:<!--]--></p><!--[--><pre><code><span class="line"><span>include:
- _pages
- .htaccess</span></span></code></pre><!--]--><!--]--></blockquote><p><!--[-->А как мы знаем наш любимый Nuxt.js как раз складывает все свои скрипты в папку под названием <code><!--[-->/_nuxt<!--]--></code>,
которая впоследствии благополучно игонрируется Jekyll. Кроме того c внедрением в Nuxt.js функционала Full Static Generator, полезная нагрузка
запросов стала выделяться в отдельный модуль <code><!--[-->_payload.js<!--]--></code> который также не будет обрабатываться.<!--]--></p><h2 id="как-это-исправить"><a href="#как-это-исправить"><!--[-->Как это исправить<!--]--></a></h2><p><!--[-->Как оказалось данная проблема уже давно общеизвестна и имеет официальное
<a href="https://github.blog/2009-12-29-bypassing-jekyll-on-github-pages/" rel="nofollow" target="_blank"><!--[-->решение<!--]--></a> от команды GitHub.
Всё что нужно сделать – это добавить специальный пустой файл <code><!--[-->.nojekyll<!--]--></code> в корень проекта, который
сообщит что для данной сборки использовать Jekyll не нужно.<!--]--></p><p><!--[-->Поэтому в корне нашего Nuxt.js проекта создаем папку <code><!--[-->/public<!--]--></code> и складываем туда пустой файл
с названием <code><!--[-->.nojekyll<!--]--></code>, пересобираем билд через <code><!--[-->yarn generate<!--]--></code>, делаем коммит и пушим.<!--]--></p><blockquote><!--[--><p><!--[-->Если вы деплоите с помощью утилиты <a href="https://www.npmjs.com/package/gh-pages" rel="nofollow" target="_blank"><!--[-->gh-pages<!--]--></a>,
то кроме всего прочего необходимо в скрипт деплоя <code><!--[-->gh-pages -d dist<!--]--></code> добавить флаг <code><!--[-->--dotfiles<!--]--></code>.
Без него файл <code><!--[-->.nojekyll<!--]--></code> опять же не попадет в финальную сборку.<!--]--></p><!--]--></blockquote><h2 id="если-всё-еще-не-завелось"><a href="#если-всё-еще-не-завелось"><!--[-->Если всё еще не завелось<!--]--></a></h2><p><!--[-->Даже если отключить Jekyll, файлы по-прежнему будут недоступны, но уже по причине их неверного URL.
Если внимательно посмотреть на ошибки 404, то можно увидеть что вызваны они отсутствием файлов
примерно по такому адресу:<!--]--></p><!--[--><pre><code><span class="line"><span>https://username.github.io/_nuxt/entry.f4606515.js</span></span></code></pre><!--]--><p><!--[-->При этом GitHub Pages генерирует и размещает проекты на URL следующего вида:<!--]--></p><!--[--><pre><code><span class="line"><span>https://username.github.io/reponame/</span></span></code></pre><!--]--><p><!--[-->Т.е. стучимся мы не туда (не хватает названия репозитория).
Решить данную проблему можно очень просто двумя способами:<!--]--></p><ol><!--[--><li><!--[-->Прикрутить собственный домен<!--]--></li><li><!--[-->Указать <code><!--[-->baseUrl<!--]--></code> в файле <code><!--[-->nuxt.config.js<!--]--></code><!--]--></li><!--]--></ol><p><!--[--><code><!--[-->baseUrl<!--]--></code> указывается в конфигурации Nuxt.js следующим образом:<!--]--></p><!--[--><pre><code><span class="line"><span class="ct-66af0d">export</span><span class="ct-8f01fd"> </span><span class="ct-66af0d">default</span><span class="ct-8f01fd"> </span><span class="ct-27a54d">defineNuxtConfig</span><span class="ct-a7edf2">({</span></span><span class="line"><span class="ct-8f01fd">    </span><span class="ct-3c677d">app</span><span class="ct-a7edf2">:</span><span class="ct-8f01fd"> </span><span class="ct-a7edf2">{</span></span><span class="line"><span class="ct-8f01fd">        </span><span class="ct-3c677d">baseURL</span><span class="ct-a7edf2">:</span><span class="ct-8f01fd"> </span><span class="ct-adb352">&#39;/reponame/&#39;</span></span><span class="line"><span class="ct-8f01fd">    </span><span class="ct-a7edf2">}</span></span><span class="line"><span class="ct-a7edf2">})</span></span></code></pre><!--]--><blockquote><!--[--><p><!--[-->Чтобы собственный домен не слетал каждый раз после очередного деплоя,
нужно в папку <code><!--[-->/public<!--]--></code> добавить файл с названием <code><!--[-->CNAME<!--]--></code> и указать там домен
который привязали в формате <code><!--[-->example.com<!--]--></code><!--]--></p><!--]--></blockquote><h3 id="ссылочная"><a href="#ссылочная"><!--[-->Ссылочная:<!--]--></a></h3><ul><!--[--><li><!--[--><a href="https://jekyllrb.com/" rel="nofollow" target="_blank"><!--[-->Jekyll<!--]--></a><!--]--></li><li><!--[--><a href="https://www.npmjs.com/package/gh-pages" rel="nofollow" target="_blank"><!--[-->gh-pages<!--]--></a><!--]--></li><li><!--[--><a href="https://github.blog/2009-12-29-bypassing-jekyll-on-github-pages/" rel="nofollow" target="_blank"><!--[-->Bypassing Jekyll On Github Pages<!--]--></a><!--]--></li><li><!--[--><a href="https://nuxtjs.org/deployments/github-pages/" rel="nofollow" target="_blank"><!--[-->Deploy Nuxt v2 on GitHub Pages<!--]--></a><!--]--></li><!--]--></ul><style>.ct-adb352{color:#C98A7D}
.ct-3c677d{color:#E0A569}
.ct-a7edf2{color:#858585}
.ct-27a54d{color:#A1B567}
.ct-8f01fd{color:#DBD7CA}
.ct-66af0d{color:#4D9375}</style></div></article><!--]--></div></section><!--]--><footer class="footer"><div class="container"><div class="footer__copyright"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"> CC BY-NC-SA 4.0 2023 </a> © Рома Столбов</div></div></footer></main><!--]--></div><script type="module">import p from "/deploy-nuxtjs-v3-to-github-pages/_payload.js";window.__NUXT__={...p,...((function(a,b,c,d){return {state:{"$scolor-mode":{preference:b,value:b,unknown:c,forced:a}},_errors:{},serverRendered:c,config:{public:{content:{locales:[],integrity:1672912251444,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:{default:"vitesse-dark"}},wsUrl:d,documentDriven:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:d}},prerenderedAt:1672912255815}}(false,"system",true,"")))}</script><script type="module" src="/_nuxt/entry.bdb45715.js" crossorigin></script><script type="module" src="/_nuxt/default.3cb96fe8.js" crossorigin></script><script type="module" src="/_nuxt/_slug_.ceeb69c5.js" crossorigin></script><script type="module" src="/_nuxt/ContentDoc.eac9264d.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.ba78f7cd.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.af1a1db5.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.6d0e47ca.js" crossorigin></script><script type="module" src="/_nuxt/ProseImg.0702c91a.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.bdbbde47.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.540490cd.js" crossorigin></script><script type="module" src="/_nuxt/ProseCodeInline.ed385caf.js" crossorigin></script><script type="module" src="/_nuxt/ProseBlockquote.e795d595.js" crossorigin></script><script type="module" src="/_nuxt/ProseCode.bf9517cc.js" crossorigin></script><script type="module" src="/_nuxt/ProseOl.de5b6f67.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.298573e3.js" crossorigin></script><script type="module" src="/_nuxt/ProseH3.16ac78a9.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.24d3a39d.js" crossorigin></script></body>
</html>